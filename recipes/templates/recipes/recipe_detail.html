{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'recipes/css/recipe_list.css' %}">
<link rel="stylesheet" href="{% static 'recipes/css/recipe-details.css' %}">
{% endblock %}

{% block content %}
<div class="details-container">
    {% if recipe.image %}
        <img src="{{recipe.image.url}}" alt="{{ recipe.title }}">
    {% elif recipe.image_url %}
        <img src="{{recipe.image_url}}" alt="{{ recipe.title }}">
    {% else %}
        <img src="{% static 'recipes/images/default.jpg' %}" alt="{{ recipe.title }}">
    {% endif %}

    <h1> {{ recipe.title }}</h1>

    <div class="details-wrapper">
        <div class="rating-container">
            {% if recipe.avg_rating %}
                <div class="star-rating" data-rating="{{ recipe.avg_rating }}">
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                </div>
                <span class="rating-text">({{ recipe.avg_rating|floatformat:1 }})</span>
            {% else %}
                <div class="star-rating" data-rating="0">
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                    <div class="star">
                        <svg class="star-outline" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                        <svg class="star-fill" viewBox="0 0 24 24">
                            <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                        </svg>
                    </div>
                </div>
            {% endif %}
            <span>({{ recipe.total_ratings }})</span>
        </div>
        <span> {{ recipe.category }}</span>
        <span> {{ recipe.cooking_time }} min</span>
    </div>
    
    <h1> Ingredients </h1>
    <span class="ingredients">
        {% if recipe.ingredients %}
            {{recipe.ingredients}}
        {% else %}
            <p>Ingredients Unavailable</p>
        {% endif %}
    </span>

    <h1> Instructions </h1>
    <span class="ingredients">
        {% if recipe.instructions %}
            {{recipe.instructions}}
        {% else %}
            <p>Instructions Unavailable</p>
        {% endif %}
    </span>
</div>
<script>
    // Initialize star ratings when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const starRatings = document.querySelectorAll('.star-rating');
        
        starRatings.forEach(container => {
            const rating = parseFloat(container.getAttribute('data-rating')) || 0;
            const stars = container.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                const starNumber = index + 1;
                const fillElement = star.querySelector('.star-fill');
                
                if (rating >= starNumber) {
                    // Full star
                    fillElement.style.clipPath = 'inset(0 0% 0 0)';
                } else if (rating > starNumber - 1) {
                    // Partial star
                    const fillPercentage = (rating - (starNumber - 1)) * 100;
                    fillElement.style.clipPath = `inset(0 ${100 - fillPercentage}% 0 0)`;
                } else {
                    // Empty star
                    fillElement.style.clipPath = 'inset(0 100% 0 0)';
                }
            });
        });
    });
</script>

{% endblock %}