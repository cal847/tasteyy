{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'recipes/css/recipe_list.css' %}">

<div class="container">
    <h2>Results in "{{ query }}"</h2>
    <div class="recipe-grid">
        {% for result in results %}
            <a href="{% url 'recipes:recipe_detail' result.slug %}" class="recipe-card" onclick="showRecipeLoading(this)">

                {% if result.image_url %}
                    <img src="{{ result.image_url }}" alt="{{ result.title }}">
                {% elif result.image %}
                    <img src="{{ result.image.url }}" alt="{{ result.title }}">
                {% else %}
                    <img src="{% static 'recipes/images/default.png' %}" alt="{{ result.title }}">
                {% endif %}

                <div class="recipe-info">
                    <h3>{{ result.title }}</h3>
                    <p>Category: {{ result.display_category }}</p>
                    <p> Cooking Time: {{ result.cooking_time }} min</p>
                    <div class="rating-container">
                        {% if result.avg_rating %}
                            <div class="star-rating" data-rating="{{ result.avg_rating }}">
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                            </div>
                            <span class="rating-text">({{ result.avg_rating|floatformat:1 }})</span>
                        {% else %}
                            <div class="star-rating" data-rating="0">
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                                <div class="star">
                                    <svg class="star-outline" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                    <svg class="star-fill" viewBox="0 0 24 24">
                                        <path d="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z"/>
                                    </svg>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </a>
        {% empty %}
            <p>No recipes found for "{{ query }}". Try a different search term!</p>
        {% endfor %}
    </div>

    {% if results.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if results.has_previous %}
                <a href="?page=1&q={{ query }}">First</a>
                <a href="?page={{ results.previous_page_number }}&q={{ query }}">Previous</a>
            {% endif %}

            <span>Page {{ results.number }} of {{ results.paginator.num_pages }}</span>

            {% if results.has_next %}
                <a href="?page={{ results.next_page_number }}&q={{ query }}">Next</a>
                <a href="?page={{ results.paginator.num_pages }}&q={{ query }}">Last</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
    // Show loading spinner on recipe cards
    function showRecipeLoading(element) {
        element.classList.add('loading');
    }

    // Initialize star ratings when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const starRatings = document.querySelectorAll('.star-rating');
        
        starRatings.forEach(container => {
            const rating = parseFloat(container.getAttribute('data-rating')) || 0;
            const stars = container.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                const starNumber = index + 1;
                const fillElement = star.querySelector('.star-fill');
                
                if (rating >= starNumber) {
                    // Full star
                    fillElement.style.clipPath = 'inset(0 0% 0 0)';
                } else if (rating > starNumber - 1) {
                    // Partial star
                    const fillPercentage = (rating - (starNumber - 1)) * 100;
                    fillElement.style.clipPath = `inset(0 ${100 - fillPercentage}% 0 0)`;
                } else {
                    // Empty star
                    fillElement.style.clipPath = 'inset(0 100% 0 0)';
                }
            });
        });
    });
</script>
{% endblock %}