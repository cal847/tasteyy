{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'recipes/css/recipe_list.css' %}">

<div class="container">
    <h2>Latest Recipes</h2>
    <div class="recipe-grid">
        {% for recipe in recipes %}
            <div class="recipe-card">
                {% if recipe.image %}
                    <img src="{{ recipe.image.url }}" alt="{{recipe.title}}">
                {% elif recipe.image_url%}
                    <img src="{{ recipe.image_url }}" alt="{{recipe.title}}">
                {% else %}
                    <img src="{% static 'recipes/images/default.jpg' %}" alt="{{recipe.title}}">
                {% endif %}
                <div class="recipe-info">
                    <h3>{{ recipe.title }}</h3>
                    <p>Category: {{ recipe.category }}</p>
                    <p> Cooking Time: {{ recipe.cooking_time }} min</p>
                    <p> Ratings: 
                        {% if recipe.avg_rating %}
                            {{ recipe.avg_rating|floatformat:1 }}
                        {% else %}
                            No ratings yet
                        {% endif %}                        
                    </p>
                </div>
            </div>
        {% empty %}
            <p>No recipes yet. Check back soon!</p>
        {% endfor %}
    </div>
    
    <h2> Top Recipes</h2>

    <div class="recipe-grid">
        {% for recipe in top_recipes %}
            <div class="recipe-card">
                {% if recipe.image %}
                    <img src="{{ recipe.image.url }}" alt="{{recipe.title}}">
                {% elif recipe.image_url%}
                    <img src="{{ recipe.image_url }}" alt="{{recipe.title}}">
                {% else %}
                    <img src="{% static 'recipes/images/default.jpg' %}" alt="{{recipe.title}}">
                {% endif %}
                <div class="recipe-info">
                    <h3>{{ recipe.title }}</h3>
                    <p>Category: {{ recipe.category }}</p>
                    <p> Cooking Time: {{ recipe.cooking_time }} min</p>
                    <p> Ratings: 
                        {% if recipe.avg_rating %}
                            {{ recipe.avg_rating|floatformat:1 }}
                        {% else %}
                            No ratings yet
                        {% endif %}                        
                    </p>
                </div>
            </div>
        {% empty %}
            <p>No recipes yet. Check back soon!</p>
        {% endfor %}
    </div>

    {% if recipes.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if recipes.has_previous %}
                <a href="?page=1" class="pagination-link">First</a>
                <a href="?page={{ recipes.previous_page_number }}" class="pagination-link">Previous</a>
            {% endif %}
            
            <!-- Show page numbers around current page -->
            {% for num in recipes.paginator.page_range %}
                {% if num == recipes.number %}
                    <span class="current-page">{{ num }}</span>
                {% elif num > recipes.number|add:'-3' and num < recipes.number|add:'3' %}
                    <a href="?page={{ num }}" class="pagination-link">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            <span class="page-info">Page {{ recipes.number }} of {{ recipes.paginator.num_pages }}</span>
            
            {% if recipes.has_next %}
                <a href="?page={{ recipes.next_page_number }}" class="pagination-link">Next</a>
                <a href="?page={{ recipes.paginator.num_pages }}" class="pagination-link">Last</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}